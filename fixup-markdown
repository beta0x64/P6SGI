#!perl6

use v6;

# Pod::To::Markdown still has some weaknesses. This script fixes various
# problems with the generated markdown for the README.md generated by this
# standard:
#
#  * Fixes unprocessed C<< >> and C< > code highlights in tables
#  * Directs class doc links to doc.perl6.org
#  * Makes the code blocks into github ```perl6``` style code blocks

for $*ARGFILES.lines -> $_ is copy {

    # Fixup unprocessed C<<>> and C<> tags
    .=subst(/ 
          "C<<" ( [ <-[ > ]> | ">" <!before ">" > ]+ ) ">>" 
        | "C<" ( <-[ > ]>+ ) ">" 
    /, { "<code>{($0 // $1).trim}</code>" }, :g);

    # Fixup unprocessed links
    .=subst(/
        'L<' ( <-[ \w \s ]>+ ) '|' ( <-[ \> ]>+ ) '>'
    /, { dd $0; dd $1; "<a href=\"$1\">$0</a>" }, :g);

    # Find links [word](word) and make them [word](http://doc.perl6.org/type/word)
    .=subst(/
        '[' ( \w+ ) '](' $0 ')'
    /, { "[$0](http://doc.perl6.org/type/$0)" }, :g);
         
    .say;
}
